# 回滚指南

## 📌 当前备份信息

**备份版本**: bc66ab7 (feat: iOS构建成功后的功能完善)  
**备份日期**: 2025-10-21  
**状态**: ✅ iOS构建成功，功能测试通过

---

## 🔄 如何回滚到此版本

### 方法一：直接回滚到备份点

```bash
# 查看当前位置
git log --oneline -5

# 回滚到备份点（保留工作区修改）
git reset --soft bc66ab7

# 或者硬回滚（丢弃所有修改，谨慎使用！）
git reset --hard bc66ab7
```

### 方法二：创建新分支保存当前状态

```bash
# 先保存当前状态到新分支
git checkout -b backup-$(date +%Y%m%d)

# 再回到主分支并回滚
git checkout main
git reset --hard bc66ab7
```

---

## 📦 依赖检查（避免构建错误）

### 1. 检查依赖完整性

```bash
# 检查 package.json 是否完整
cat package.json

# 重新安装依赖（如果出现问题）
rm -rf node_modules package-lock.json
npm install
```

### 2. 关键依赖版本

回滚后确保以下依赖版本正确：

```json
{
  "dependencies": {
    "@dcloudio/uni-app": "3.0.0-4020920240930001",
    "vue": "^3.4.21",
    "big.js": "^6.2.1",
    "pinia": "^2.1.7",
    "pinia-plugin-persistedstate": "^3.2.1"
  }
}
```

---

## 🔍 回滚后验证清单

### 功能验证
- [ ] 汇率数据能正常加载
- [ ] 货币计算准确
- [ ] 输入功能正常
- [ ] 货币选择正常
- [ ] 设置页面正常

### 构建验证
```bash
# 清理构建缓存
rm -rf unpackage/dist

# 重新构建
npm run dev:app-plus

# 检查是否有编译错误
```

### iOS 构建验证
1. 在 HBuilderX 中打开项目
2. 选择 "发行 -> 原生App-云打包"
3. 选择 iOS 平台
4. 等待打包完成
5. 下载并测试 ipa 文件

---

## 🚨 常见回滚问题及解决

### 问题1: 依赖缺失错误

**症状**: 
```
Error: Cannot find module 'xxx'
```

**解决**:
```bash
npm install
```

### 问题2: 构建失败

**症状**: 
```
Build failed with errors
```

**解决**:
```bash
# 清理缓存
rm -rf unpackage node_modules
npm install
npm run dev:app-plus
```

### 问题3: git 冲突

**症状**:
```
error: Your local changes to the following files would be overwritten
```

**解决**:
```bash
# 暂存当前修改
git stash

# 回滚
git reset --hard bc66ab7

# 如需恢复修改
git stash pop
```

### 问题4: iOS 构建错误

**症状**: 云打包失败

**解决**:
1. 检查 manifest.json 配置
2. 确认 iOS 证书配置正确
3. 查看 HBuilderX 控制台错误信息
4. 参考 `iOS构建指南.md`

---

## 📂 重要文件备份

以下文件在回滚时需要特别注意：

### 1. 配置文件
- `manifest.json` - App 配置
- `pages.json` - 页面路由配置
- `package.json` - 依赖配置

### 2. 数据文件
- `data/currencies.js` - 货币数据
- `data/default-rates.js` - 默认汇率数据

### 3. 核心业务文件
- `store/rate.js` - 汇率状态管理
- `store/currency.js` - 货币状态管理
- `utils/calculate.js` - 计算工具

---

## 🎯 回滚后的测试流程

### 1. 基础功能测试（5分钟）
```
✓ 启动应用
✓ 查看汇率更新
✓ 添加货币
✓ 输入金额计算
✓ 切换基准货币
```

### 2. 完整功能测试（15分钟）
```
✓ 货币列表操作
✓ 长按操作
✓ 设置页面
✓ 小数位设置
✓ 千分位设置
✓ 语言切换
✓ 汇率手动刷新
```

### 3. 构建测试（30分钟）
```
✓ 开发环境运行
✓ 真机调试
✓ 云打包构建
✓ 安装测试
```

---

## 💡 最佳实践

### 回滚前
1. ✅ 先创建备份分支
2. ✅ 记录当前的 commit hash
3. ✅ 导出重要的本地数据
4. ✅ 通知团队成员（如适用）

### 回滚时
1. ✅ 使用 `git reset --soft` 优先
2. ✅ 验证回滚后的代码状态
3. ✅ 检查依赖完整性
4. ✅ 运行测试

### 回滚后
1. ✅ 执行完整的功能测试
2. ✅ 重新构建并验证
3. ✅ 更新文档
4. ✅ 记录回滚原因

---

## 📞 紧急联系

如果遇到无法解决的问题：

1. 查看项目根目录下的所有 `.md` 文档
2. 查看 `功能完善备份说明.md` 了解具体修改
3. 查看 Git 提交历史: `git log --all --graph --decorate --oneline`

---

## 🔖 快速命令参考

```bash
# 查看当前版本
git log --oneline -1

# 查看文件修改历史
git log --follow -- <文件路径>

# 查看某个提交的详细信息
git show bc66ab7

# 对比两个版本的差异
git diff <old-commit> <new-commit>

# 恢复单个文件到备份版本
git checkout bc66ab7 -- <文件路径>

# 查看未提交的修改
git status
git diff

# 临时保存修改
git stash
git stash list
git stash pop
```

---

## ⚠️ 重要提示

1. **回滚操作不可逆**: 使用 `git reset --hard` 前请三思
2. **依赖版本匹配**: 确保 package.json 与代码版本一致
3. **测试充分**: 回滚后必须进行完整测试
4. **数据备份**: 重要的用户数据需单独备份

---

**最后更新**: 2025-10-21  
**维护人**: 开发团队  
**版本**: v1.0

